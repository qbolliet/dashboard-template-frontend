@use '../../../../../styles/utils/breakpoints' as *;
@use '../../../../../styles/globals/colors';

// ===== VARIABLES DE PERSONNALISATION =====
// Variables essentielles pour modifier l'apparence des dropdowns de navigation

// ===== LIENS PRINCIPAUX =====
$dropdown-link-padding-mobile: var(--spacing-md) var(--spacing-lg) !default;
$dropdown-link-padding-desktop: var(--spacing-sm) var(--spacing-sm) var(--spacing-sm) var(--spacing-lg) !default;
$dropdown-link-font-weight: 500 !default;
$dropdown-link-font-weight-active: 600 !default;
$dropdown-link-font-size: var(--font-size-sm) !default;
$dropdown-link-border-radius: var(--border-radius-md) !default;
$dropdown-link-transition: all var(--transition-normal) ease !default;

// ===== DROPDOWN MENU =====
$dropdown-min-width: 220px !default;
$dropdown-border-radius: var(--border-radius-lg) !default;
$dropdown-padding: var(--spacing-sm) 0 !default;
$dropdown-z-index: var(--z-dropdown) !default;

// Animation dropdown
$dropdown-transition-duration: var(--transition-slow) !default;
$dropdown-transition-easing: ease !default;
$dropdown-translate-y: calc(var(--spacing-sm) * -1) !default;

// ===== ÉLÉMENTS DROPDOWN =====
$dropdown-item-padding: var(--spacing-md) !default;
$dropdown-item-gap: var(--spacing-xs) !default;

// Liens simples
$dropdown-link-simple-padding: var(--spacing-md) var(--spacing-lg) !default;
$dropdown-link-simple-font-size: var(--font-size-sm) !default;
$dropdown-link-simple-font-weight: 400 !default;
$dropdown-link-simple-font-weight-active: 500 !default;

// En-têtes de groupe
$dropdown-group-padding: var(--spacing-md) !default;
$dropdown-group-header-font-size: var(--font-size-sm) !default;
$dropdown-group-header-font-weight: 600 !default;
$dropdown-group-header-padding: var(--spacing-sm) !default;
$dropdown-group-header-margin-bottom: var(--spacing-sm) !default;

// Sous-liens
$dropdown-sublink-padding: var(--spacing-sm) var(--spacing-md) !default;
$dropdown-sublink-font-size: var(--font-size-xs) !default;
$dropdown-sublink-font-weight: 400 !default;
$dropdown-sublink-font-weight-active: 500 !default;
$dropdown-sublink-gap: var(--spacing-sm) !default;

// Chevrons
$dropdown-chevron-size-desktop: calc(var(--spacing-xl) + var(--spacing-xs)) !default; // 24px
$dropdown-chevron-size-tablet: calc(var(--spacing-2xl) + var(--spacing-xs)) !default; // 28px  
$dropdown-chevron-size-mobile: var(--spacing-4xl) !default; // 32px
$dropdown-chevron-border-radius: var(--border-radius-md) !default;
$dropdown-chevron-transition: all var(--transition-normal) ease !default;

// ===== RESPONSIVE MOBILE =====
$dropdown-mobile-max-height: 500px !default;
$dropdown-mobile-sublist-max-height: 300px !default;
$dropdown-mobile-padding-left: calc(var(--spacing-3xl) + var(--spacing-lg)) !default;
$dropdown-mobile-padding-left-small: var(--spacing-lg) !default;
$dropdown-mobile-sublink-padding-left: var(--spacing-md) !default;

// Focus
$dropdown-focus-outline-width: 2px !default;
$dropdown-focus-shadow-size: var(--spacing-2px) !default;

// ===== DROPDOWN NAVIGATION ITEM =====
// Élément de navigation avec dropdown complexe

.nav-item--dropdown {
    // Reset des styles de base
    position: relative;
    
    // En-tête de l'élément avec lien et bouton dropdown
    .nav-item__header {
        display: flex;
        align-items: center;
        
        // Sur mobile, justifier l'espace entre le lien et le bouton
        @include breakpoint-down('medium') {
            justify-content: space-between;
            width: 100%;
        }
    }
    
    // Lien principal avec moins d'espacement à droite pour le bouton dropdown
    .nav-link {
        display: inline-flex;
        align-items: center;
        padding: $dropdown-link-padding-desktop;
        
        // Couleurs et styles
        color: hsl(var(--nav-link-color));
        text-decoration: none;
        font-weight: $dropdown-link-font-weight;
        font-size: $dropdown-link-font-size;
        border-radius: $dropdown-link-border-radius;
        transition: $dropdown-link-transition;
        white-space: nowrap;

        // Sur les grands écrans
        @include breakpoint('large') {
            // Espacement plus compact
            padding: $dropdown-link-padding-desktop;
        }
        
        // Sur mobile, prendre toute la largeur disponible
        @include breakpoint-down('medium') {
            width: 100%;
            padding: $dropdown-link-padding-mobile;
            font-size: $dropdown-link-font-size;
        }
        
        // États d'interaction
        &:hover {
            color: hsl(var(--nav-link-hover-color));
            background-color: hsl(var(--nav-link-hover-bg));
        }
        
        &:focus {
            outline: $dropdown-focus-outline-width solid hsl(var(--nav-link-focus-color));
            outline-offset: $dropdown-focus-outline-width;
        }
        
        // État actif
        &--active {
            color: hsl(var(--nav-link-active-color));
            background-color: hsl(var(--nav-link-active-bg));
            font-weight: $dropdown-link-font-weight-active;
        }
        
        // État avec enfant actif
        &--has-active-child {
            color: hsl(var(--nav-link-active-child-color));
            background-color: hsl(var(--nav-link-active-child-bg));
        }
    }
}

// ===== DROPDOWN MENU =====
.nav-dropdown {
    // Positionnement desktop
    position: absolute;
    top: 100%;
    left: 0;
    min-width: $dropdown-min-width;
    
    // Couleurs et forme
    background-color: hsl(var(--nav-dropdown-bg));
    border: 1px solid hsl(var(--nav-dropdown-border));
    border-radius: $dropdown-border-radius;
    box-shadow: 0 var(--spacing-xs) var(--spacing-md) hsla(var(--nav-dropdown-shadow) / 0.1);
    padding: $dropdown-padding;
    z-index: $dropdown-z-index;
    
    // Animation d'apparition
    opacity: 0;
    visibility: hidden;
    transform: translateY($dropdown-translate-y);
    transition: all $dropdown-transition-duration $dropdown-transition-easing;
    
    // État ouvert
    &--open {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }
    
    // ===== LISTE SIMPLE =====
    &__list {
        list-style: none;
        margin: 0;
        padding: $dropdown-item-padding;
        display: flex;
        flex-direction: column;
        gap: $dropdown-item-gap;
    }
    
    &__item {
        margin: 0;
    }
    
    &__link {
        display: block;
        padding: $dropdown-link-simple-padding;
        color: hsl(var(--nav-dropdown-link-color));
        text-decoration: none;
        font-size: $dropdown-link-simple-font-size;
        font-weight: $dropdown-link-simple-font-weight;
        transition: $dropdown-link-transition;
        border-radius: $dropdown-link-border-radius;
        
        &:hover {
            color: hsl(var(--nav-dropdown-link-hover-color));
            background-color: hsl(var(--nav-dropdown-link-hover-bg));
        }
        
        &--active {
            color: hsl(var(--nav-dropdown-link-active-color));
            background-color: hsl(var(--nav-dropdown-link-active-bg));
            font-weight: $dropdown-link-simple-font-weight-active;
        }
    }
    
    // ===== GROUPES AVEC SOUS-ÉLÉMENTS =====
    &__groups {
        display: flex;
        flex-direction: row;
        gap: 0;
    }
    
    &__group {
        display: flex;
        flex-direction: column;
        padding: $dropdown-group-padding;
        
        &:not(:last-child) {
            border-right: 1px solid hsl(var(--nav-dropdown-separator));
        }
    }
    
    &__group-header-wrapper {
        display: flex;
        align-items: center;
        position: relative;
        width: 100%; // Assurer que le wrapper prend toute la largeur
    }
    
    &__group-chevron {
        // Masqué par défaut sur desktop - suit le pattern dropdown-toggle-button
        display: none;
        align-items: center;
        justify-content: center;
        background: none;
        border: 1px solid transparent; // Bordure fine transparente par défaut
        cursor: pointer;
        padding: 0;
        box-sizing: border-box;
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
        
        // Dimensions avec variables système - suivre le pattern responsive
        width: $dropdown-chevron-size-desktop;
        height: $dropdown-chevron-size-desktop;
        
        // Forme avec variables système
        border-radius: $dropdown-chevron-border-radius;
        
        // Couleurs depuis le système HSL
        color: hsl(var(--nav-dropdown-group-header-color));
        
        // Transitions avec variables système
        transition: $dropdown-chevron-transition;
        transform-origin: center center;
        
        // États d'interaction améliorés
        &:hover {
            background-color: hsl(var(--nav-dropdown-group-header-hover-bg));
            border-color: hsl(var(--nav-dropdown-group-header-hover-color) / 0.2);
            color: hsl(var(--nav-dropdown-group-header-hover-color));
        }
        
        &:focus {
            outline: none;
            border-color: hsl(var(--nav-dropdown-group-header-active-color));
            box-shadow: 0 0 0 $dropdown-focus-shadow-size hsl(var(--nav-dropdown-group-header-active-bg) / 0.3);
        }
        
        &:active {
            transform: scale(0.95);
        }
        
        &--expanded {
            background-color: hsl(var(--nav-dropdown-group-header-hover-bg));
            border-color: hsl(var(--nav-dropdown-group-header-color) / 0.2);
            
            svg {
                transform: rotate(180deg);
            }
        }
        
        svg {
            display: block;
            flex-shrink: 0;
            transition: transform $dropdown-transition-duration $dropdown-transition-easing;
            transform-origin: center center;
        }
    }
    
    &__group-header {
        display: block;
        flex: 1;
        padding: $dropdown-group-header-padding;
        border-radius: $dropdown-link-border-radius;
        color: hsl(var(--nav-dropdown-group-header-color));
        text-decoration: none;
        font-size: $dropdown-group-header-font-size;
        font-weight: $dropdown-group-header-font-weight;
        transition: $dropdown-link-transition;
        margin-bottom: $dropdown-group-header-margin-bottom;
        
        &:hover {
            color: hsl(var(--nav-dropdown-group-header-hover-color));
            background-color: hsl(var(--nav-dropdown-group-header-hover-bg));
        }
        
        &--active {
            color: hsl(var(--nav-dropdown-group-header-active-color));
            background-color: hsl(var(--nav-dropdown-group-header-active-bg));
        }
    }
    
    &__sublist {
        display: flex;
        flex-direction: column;
        list-style: none;
        margin: 0;
        padding: 0;
        gap: $dropdown-sublink-gap;
    }
    
    &__subitem {
        margin: 0;
    }
    
    &__sublink {
        display: block;
        padding: $dropdown-sublink-padding;
        color: hsl(var(--nav-dropdown-sublink-color));
        text-decoration: none;
        font-size: $dropdown-sublink-font-size;
        font-weight: $dropdown-sublink-font-weight;
        transition: $dropdown-link-transition;
        border-radius: $dropdown-link-border-radius;
        
        &:hover {
            background-color: hsl(var(--nav-dropdown-sublink-hover-bg));
            color: hsl(var(--nav-dropdown-sublink-hover-color));
        }
        
        &--active {
            color: hsl(var(--nav-dropdown-sublink-active-color));
            background-color: hsl(var(--nav-dropdown-sublink-active-bg));
            font-weight: $dropdown-sublink-font-weight-active;
        }
    }
}

// ===== RESPONSIVE MOBILE =====
@include breakpoint-down('medium') {
    .nav-item--dropdown {
        width: 100%;
        border-bottom: 1px solid hsl(var(--nav-mobile-separator));
        
        &:last-child {
            border-bottom: none;
        }
        
        // Sur très petits écrans, centrer mais garder le toggle à droite
        @include breakpoint-down('small') {
            .nav-item__header {
                justify-content: center;
                position: relative;

                .nav-link {
                    text-align: center;
                    flex: 1;
                    justify-content: center;
                    padding: var(--spacing-md) 0 var(--spacing-md) var(--spacing-4xl) ;
                }
            }
        }
    }
    
    .nav-dropdown {
        // Reset du positionnement desktop
        position: static;
        width: 100%;
        border: none;
        border-radius: 0;
        box-shadow: none;
        background-color: hsl(var(--nav-dropdown-mobile-bg));
        
        // Animation par hauteur sur mobile
        transform: none;
        opacity: 1;
        visibility: visible;
        max-height: 0;
        overflow: hidden;
        transition: max-height $dropdown-transition-duration $dropdown-transition-easing;
        padding: 0;
        
        &--open {
            max-height: $dropdown-mobile-max-height;
        }
        
        // Groupes en colonne sur mobile
        &__groups {
            flex-direction: column;
        }
        
        &__group {
            padding: 0;
            
            &:not(:last-child) {
                border-right: none;
                border-bottom: 1px solid hsl(var(--nav-dropdown-separator));
                margin-bottom: var(--spacing-sm);
                padding-bottom: var(--spacing-sm);
            }
        }
        
        &__group-header {
            flex: 1;
            justify-content: space-between;
            padding-right: var(--spacing-4xl); // Espace pour le chevron
        }
        
        &__group-chevron {
            // Afficher le chevron sur mobile - taille responsive
            display: flex;
            //position: absolute;
            //right: var(--spacing-lg);
            //top: 50%;
            //transform: translateY(-50%);
            z-index: 2;
            
            // Taille tablette - légèrement plus grande pour touch
            width: $dropdown-chevron-size-tablet;
            height: $dropdown-chevron-size-tablet;
            
            // Désactiver l'effet de scale sur mobile/tablette pour éviter les problèmes tactiles
            // &:hover {
            //     transform: translateY(-50%);
            // }
            
            // &:active {
            //     transform: translateY(-50%) scale(0.95);
            // }
            
            &--expanded {
                //transform: translateY(-50%);
                
                svg {
                    transform: rotate(180deg);
                }
                
                // &:hover {
                //     transform: translateY(-50%);
                // }
                
                // &:active {
                //     transform: translateY(-50%) scale(0.95);
                // }
            }
        }
        
        &__sublist {
            max-height: 0;
            overflow: hidden;
            transition: max-height $dropdown-transition-duration $dropdown-transition-easing;
            
            &--expanded {
                max-height: $dropdown-mobile-sublist-max-height;
            }
        }
        
        &__link {
            font-size: $dropdown-link-simple-font-size;
            
            &:hover {
                background-color: hsl(var(--nav-dropdown-link-hover-bg) / 0.2);
            }
        }
        
        &__group-header,
        &__sublink {
            padding-left: $dropdown-mobile-padding-left;
            font-size: $dropdown-link-simple-font-size;
            
            &:hover {
                background-color: hsl(var(--nav-dropdown-link-hover-bg) / 0.2);
            }
        }
        
        &__group-header {
            padding: $dropdown-group-header-padding var(--spacing-3xl);
        }

        @include breakpoint-down('small') {
            &__link {
                padding-left: $dropdown-mobile-padding-left-small;
            }
            &__sublink {
                padding-left: $dropdown-mobile-sublink-padding-left;
            }
            
            // Chevron encore plus grand sur très petits écrans pour l'accessibilité tactile
            &__group-chevron {
                width: $dropdown-chevron-size-mobile;
                height: $dropdown-chevron-size-mobile;
            }

            &__group-header {
                padding: $dropdown-group-header-padding 0 $dropdown-group-header-padding var(--spacing-4xl);
            }
        }
    }
}