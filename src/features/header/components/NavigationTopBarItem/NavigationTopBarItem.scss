// ===== IMPORTS =====
@use '../../../../styles/globals/colors';
@use '../../../../styles/utils/breakpoints';

// ===== VARIABLES LOCALES =====
// Utilisation des variables système pour l'espacement et les transitions
$nav-item-padding: var(--spacing-md) var(--spacing-lg); // 12px 16px
$nav-item-mobile-padding: var(--spacing-lg) var(--spacing-2xl); // 16px 24px  
$dropdown-transition: var(--transition-slow) ease; // 0.3s ease

// ===== ÉLÉMENT DE NAVIGATION PRINCIPAL =====
.nav-item {
  position: relative;
  list-style: none;
  
  // ===== EN-TÊTE DE L'ÉLÉMENT =====
  &__header {
    display: flex;
    align-items: center;
  }
}

// ===== LIEN DE NAVIGATION =====
.nav-link {
  display: inline-flex;
  align-items: center;
  
  // Espacement avec variables système
  padding: $nav-item-padding;
  
  // Couleurs depuis le système HSL
  color: hsl(var(--nav-link-color));
  text-decoration: none;
  
  // Typographie avec variables système
  font-weight: 500;
  font-size: var(--font-size-sm); // 14px
  
  // Forme avec variables système
  border-radius: var(--border-radius-md); // 6px
  
  // Transitions avec variables système
  transition: all var(--transition-normal) ease;
  white-space: nowrap;
  position: relative;
  
  // États d'interaction
  &:hover {
    color: hsl(var(--nav-link-hover-color));
    background-color: hsl(var(--nav-link-hover-bg));
  }
  
  &:focus {
    outline: var(--spacing-2px) solid hsl(var(--nav-link-focus-color));
    outline-offset: var(--spacing-2px);
  }
  
  // État actif (page courante)
  &--active {
    color: hsl(var(--nav-link-active-color));
    background-color: hsl(var(--nav-link-active-bg));
    font-weight: 600;
    
    // Indicateur visuel pour la page active
    &::after {
      content: '';
      position: absolute;
      bottom: calc(var(--spacing-2px) * -1); // -2px
      left: 50%;
      transform: translateX(-50%);
      width: 80%;
      height: var(--spacing-2px); // 2px
      background-color: hsl(var(--nav-link-active-color));
      border-radius: 1px;
    }
  }
  
  // État avec enfant actif
  &--has-active-child {
    color: hsl(var(--nav-link-active-child-color));
    background-color: hsl(var(--nav-link-active-child-bg));
  }
}

// ===== ÉTATS DE L'ÉLÉMENT DE NAVIGATION =====
.nav-item {
  // Élément avec dropdown
  &--has-dropdown {
    .nav-link {
      // Moins d'espace à droite car le bouton dropdown sera à côté
      padding-right: var(--spacing-sm); // 8px
    }
  }
  
  // Élément actif - styles supplémentaires si nécessaire
  &--active {
    // Réservé pour les styles spécifiques à l'élément
  }
  
  // Élément avec enfant actif - styles supplémentaires si nécessaire
  &--has-active-child {
    // Réservé pour les styles spécifiques à l'élément
  }
}

// ===== DROPDOWN =====
.nav-dropdown {
  position: absolute;
  top: 100%;
  left: 0;
  
  // Largeur minimale avec variables système
  min-width: calc(var(--spacing-5xl) * 4 + var(--spacing-3xl)); // ~220px
  
  // Couleurs depuis le système HSL
  background-color: hsl(var(--nav-dropdown-bg));
  border: 1px solid hsl(var(--nav-dropdown-border));
  
  // Forme avec variables système
  border-radius: var(--border-radius-lg); // 8px
  
  // Ombre avec système de couleurs HSL
  box-shadow: 0 var(--spacing-xs) var(--spacing-md) hsl(var(--nav-dropdown-shadow) / 0.1);
  
  // Espacement interne
  padding: var(--spacing-sm) 0; // 8px vertical
  
  // Z-index depuis les variables système
  z-index: var(--z-dropdown); // 1000
  
  // Animation d'apparition
  opacity: 0;
  visibility: hidden;
  transform: translateY(calc(var(--spacing-sm) * -1)); // -8px
  transition: all $dropdown-transition;
  
  // État ouvert
  &--open {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }
  
  // Liste du dropdown
  &__list {
    list-style: none;
    margin: 0;
    padding: 0;
  }
  
  // Élément du dropdown
  &__item {
    margin: 0;
  }
  
  // Lien du dropdown
  &__link {
    display: block;
    
    // Espacement avec variables système
    padding: var(--spacing-md) var(--spacing-lg); // 12px 16px
    
    // Couleurs depuis le système HSL
    color: hsl(var(--nav-dropdown-link-color));
    text-decoration: none;
    
    // Typographie avec variables système
    font-size: var(--font-size-sm); // 14px
    font-weight: 400;
    
    // Transition avec variables système
    transition: all var(--transition-normal) ease;
    
    &:hover {
      background-color: hsl(var(--nav-dropdown-link-hover-bg));
      color: hsl(var(--nav-dropdown-link-hover-color));
    }
    
    &--active {
      color: hsl(var(--nav-dropdown-link-active-color));
      background-color: hsl(var(--nav-dropdown-link-active-bg));
      font-weight: 500;
    }
  }
  
  // ===== GROUPES AVEC SOUS-ÉLÉMENTS =====
  &__groups {
    display: flex;
    flex-direction: row;
    gap: 0;
  }
  
  &__group {
    display: flex;
    flex-direction: column;
    
    // Espacement interne avec variables système
    padding: calc(var(--spacing-lg) + var(--spacing-xs)); // ~20px
    
    &:not(:last-child) {
      border-right: 1px solid hsl(var(--nav-dropdown-separator));
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: calc(var(--spacing-lg) + var(--spacing-xs)); // ~20px
    }
  }
  
  &__group-header-wrapper {
    display: flex;
    align-items: center;
    position: relative;
    // Pas de justify-content: space-between sur desktop
    // Le lien prendra toute la largeur disponible
  }
  
  &__group-chevron {
    // Masqué par défaut sur desktop
    display: none;
    background: none;
    border: none;
    cursor: pointer;
    color: hsl(var(--nav-dropdown-group-header-color));
    padding: var(--spacing-sm);
    border-radius: var(--border-radius-sm);
    transition: all var(--transition-normal) ease;
    
    &:hover {
      background-color: hsl(var(--nav-dropdown-group-header-hover-bg));
    }
    
    // Rotation du chevron quand développé
    &--expanded {
      transform: rotate(180deg);
    }
  }
  
  &__group-header {
    display: block;
    flex: 1; // Prend toute la largeur disponible sur desktop
    
    // Espacement avec variables système
    padding: var(--spacing-sm) 0; // 8px vertical
    
    // Couleurs depuis le système HSL
    color: hsl(var(--nav-dropdown-group-header-color));
    text-decoration: none;
    
    // Typographie avec variables système
    font-size: var(--font-size-sm); // 14px
    font-weight: 600;
    
    // Transition et espacement
    transition: all var(--transition-normal) ease;
    margin-bottom: var(--spacing-sm); // 8px
    
    &:hover {
      background-color: hsl(var(--nav-dropdown-group-header-hover-bg));
    }
    
    &--active {
      color: hsl(var(--nav-dropdown-group-header-active-color));
      background-color: hsl(var(--nav-dropdown-group-header-active-bg));
    }
  }
  
  &__sublist {
    display: flex;
    flex-direction: column;
    list-style: none;
    margin: 0;
    padding: 0;
    
    // Espacement entre sous-éléments avec variables système
    gap: var(--spacing-sm); // 8px
  }
  
  &__subitem {
    margin: 0;
  }
  
  &__sublink {
    display: block;
    
    // Espacement avec variables système
    padding: var(--spacing-sm) 0; // 8px vertical
    
    // Couleurs depuis le système HSL
    color: hsl(var(--nav-dropdown-sublink-color));
    text-decoration: none;
    
    // Typographie avec variables système (plus petite pour les sous-liens)
    font-size: var(--font-size-xs); // 12px
    font-weight: 400;
    
    // Transition avec variables système
    transition: all var(--transition-normal) ease;
    
    &:hover {
      background-color: hsl(var(--nav-dropdown-sublink-hover-bg));
      color: hsl(var(--nav-dropdown-sublink-hover-color));
    }
    
    &--active {
      color: hsl(var(--nav-dropdown-sublink-active-color));
      background-color: hsl(var(--nav-dropdown-sublink-active-bg));
      font-weight: 500;
    }
  }
}

// ===== RESPONSIVE =====
// Tablette et mobile
@include breakpoints.breakpoint-down(medium) {
  .nav-item {
    width: 100%;
    
    // Séparateur entre éléments mobiles avec couleurs système
    border-bottom: 1px solid hsl(var(--nav-mobile-separator));
    
    &:last-child {
      border-bottom: none;
    }
    
    &__header {
      justify-content: space-between;
      width: 100%;
    }
  }
  
  .nav-link {
    // Espacement mobile plus généreux
    padding: $nav-item-mobile-padding;
    width: 100%;
    justify-content: space-between;
    
    // Taille de police plus grande pour mobile
    font-size: var(--font-size-base); // 16px
    
    // AMÉLIORATION HOVER MOBILE : background plus visible
    &:hover {
      // Couleur de fond plus prononcée sur mobile
      background-color: hsl(var(--nav-link-hover-bg) / 0.15); // Opacité augmentée
    }
    
    // Désactiver l'indicateur de page active sur mobile
    &--active::after {
      display: none;
    }
  }
  
  // Le dropdown devient un sous-menu déroulant sur mobile
  .nav-dropdown {
    position: static;
    width: 100%;
    border: none;
    border-radius: 0;
    box-shadow: none;
    
    // Couleur de fond spécifique mobile depuis le système
    background-color: hsl(var(--nav-dropdown-mobile-bg));
    
    // Réinitialisation de l'animation desktop
    transform: none;
    opacity: 1;
    visibility: visible;
    
    // Animation par hauteur pour mobile
    max-height: 0;
    overflow: hidden;
    transition: max-height $dropdown-transition ease;
    padding: 0;
    
    &--open {
      // Hauteur suffisante pour le contenu (utilisation calc avec variables)
      max-height: calc(var(--spacing-5xl) * 10); // ~500px
    }
    
    // Repasser en disposition verticale sur mobile
    &__groups {
      flex-direction: column;
    }
    
    &__group {
      padding: 0;
      
      &:not(:last-child) {
        border-right: none;
        border-bottom: 1px solid var(--nav-dropdown-separator, #f3f4f6);
        margin-bottom: 0.5rem;
        padding-bottom: 0.5rem;
      }
    }
    
    &__group-header-wrapper {
      display: flex;
      align-items: center;
      position: relative;
      // Pas de justify-content: space-between pour permettre au lien d'occuper la largeur
    }
    
    &__group-header {
      // Sur mobile, le lien prend presque toute la largeur
      flex: 1;
      // Ajouter du padding à droite pour éviter la superposition avec le chevron
      padding-right: var(--spacing-3xl); // 32px pour laisser la place au chevron
    }
    
    &__group-chevron {
      // Afficher le chevron sur mobile/tablette uniquement
      display: block;
      // Positionnement absolu pour ne pas affecter la largeur du lien
      position: absolute;
      right: var(--spacing-sm); // 8px du bord droit
      top: 50%;
      transform: translateY(-50%);
      // S'assurer que le chevron reste cliquable
      z-index: 2;
      
      // Animation de rotation quand développé (doit rester même en absolu)
      &--expanded {
        transform: translateY(-50%) rotate(180deg);
      }
    }
    
    &__sublist {
      // Masqué par défaut sur mobile
      max-height: 0;
      overflow: hidden;
      transition: max-height var(--transition-slow) ease;
      
      // Développé quand la classe --expanded est ajoutée
      &--expanded {
        max-height: calc(var(--spacing-5xl) * 6); // ~300px pour les sous-éléments
      }
    }
    
    &__link,
    &__group-header,
    &__sublink {
      // Plus d'indentation sur mobile avec variables système
      padding-left: var(--spacing-3xl); // 32px
      font-size: var(--font-size-sm); // 14px
      
      // AMÉLIORATION HOVER MOBILE pour les dropdowns
      &:hover {
        background-color: hsl(var(--nav-dropdown-link-hover-bg) / 0.2); // Opacité augmentée
      }
    }
    
    &__group-header {
      padding: var(--spacing-sm) var(--spacing-3xl); // 8px 32px
    }
    
    &__sublink {
      // Encore plus d'indentation pour les sous-éléments
      padding-left: calc(var(--spacing-3xl) + var(--spacing-lg)); // 48px
    }
  }
}

// ===== STYLES TERMINÉS =====
// Les couleurs et variables sont maintenant gérées dans le système de design global
// Voir src/styles/globals/colors.scss pour les variables de couleurs de navigation
// Améliorations apportées :
// - Utilisation systématique des variables rem/variables système
// - Couleurs HSL avec syntaxe hsl(var(--color-name)) pour flexibilité d'opacité
// - Hover mobile amélioré avec background-color plus visible
// - Structure claire avec commentaires en français