@use '../../../../styles/globals/typography';
@use '../../../../styles/globals/colors';
@use '../../../../styles/utils/breakpoints';

// ===== VARIABLES LOCALES =====
$search-height: calc(var(--spacing-3xl) + var(--spacing-xs)); // ~36px
$transition-duration: var(--transition-normal);

// ===== CONTENEUR PRINCIPAL =====
.search-container {
  position: relative;
  width: 100%;
  max-width: 20rem; // 320px
  
  // État focus du conteneur
  &.search-container--focused {
    .search-form {
      border-color: hsl(var(--search-border-focus));
      box-shadow: 0 0 0 var(--spacing-2px) hsl(var(--search-shadow-focus) / 0.2);
    }
  }
}

// ===== FORMULAIRE DE RECHERCHE =====
.search-form {
  position: relative;
  display: flex;
  align-items: center;
  width: 100%;
  height: $search-height;
  background-color: hsl(var(--search-bg));
  border: 1px solid hsl(var(--search-border));
  border-radius: var(--border-radius-md);
  transition: all $transition-duration ease;
  
  &:hover {
    border-color: hsl(var(--search-border-hover));
  }
}

// ===== ICÔNE DE RECHERCHE =====
.search-icon {
  position: absolute;
  left: var(--spacing-md);
  display: flex;
  align-items: center;
  color: hsl(var(--search-icon));
  pointer-events: none;
  z-index: 2;
  
  svg {
    width: 1rem;
    height: 1rem;
  }
}

// ===== CHAMP DE SAISIE =====
.search-input {
  width: 100%;
  height: 100%;
  padding: 0 var(--spacing-4xl) 0 calc(var(--spacing-3xl) + var(--spacing-xs));
  border: none;
  background: transparent;
  color: hsl(var(--search-text));
  font-size: var(--font-size-sm);
  font-family: inherit;
  border-radius: var(--border-radius-md);
  outline: none;
  
  &::placeholder {
    color: hsl(var(--search-placeholder));
    font-style: italic;
  }
  
  // Supprimer les styles par défaut du type search
  &[type="search"] {
    appearance: none;
    
    // Supprimer le X sur Chrome
    &::-webkit-search-cancel-button,
    &::-webkit-search-decoration {
      -webkit-appearance: none;
      display: none;
    }
  }
  
  // Styles pour l'autocomplétion
  &:-webkit-autofill {
    -webkit-box-shadow: 0 0 0 30px hsl(var(--search-bg)) inset;
    -webkit-text-fill-color: hsl(var(--search-text));
  }
}

// ===== BOUTON D'EFFACEMENT =====
.search-clear {
  position: absolute;
  right: var(--spacing-sm);
  display: flex;
  align-items: center;
  justify-content: center;
  width: var(--spacing-xl);
  height: var(--spacing-xl);
  padding: 0;
  border: none;
  background: transparent;
  color: hsl(var(--search-clear));
  border-radius: var(--border-radius-sm);
  cursor: pointer;
  transition: all $transition-duration ease;
  z-index: 2;
  
  &:hover {
    background-color: hsl(var(--search-clear-hover-bg));
    color: hsl(var(--search-clear-hover));
  }
  
  &:focus {
    outline: 2px solid hsl(var(--search-border-focus));
    outline-offset: 1px;
  }
  
  svg {
    width: var(--font-size-sm);
    height: var(--font-size-sm);
  }
}

// ===== SUGGESTIONS =====
.search-suggestions {
  position: absolute;
  top: calc(100% + var(--spacing-xs));
  left: 0;
  right: 0;
  background-color: hsl(var(--suggestions-bg));
  border: 1px solid hsl(var(--suggestions-border));
  border-radius: var(--border-radius-md);
  box-shadow: var(--shadow-lg);
  max-height: 18.75rem;
  overflow-y: auto;
  z-index: 1000;
  
  // Animation d'apparition
  animation: slideDown var(--transition-normal) ease;
  
  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(calc(-1 * var(--spacing-sm)));
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
}

// ===== SUGGESTION INDIVIDUELLE =====
.search-suggestion {
  display: flex;
  align-items: center;
  padding: var(--spacing-sm) var(--spacing-md);
  cursor: pointer;
  transition: background-color $transition-duration ease;
  border-bottom: 1px solid hsl(var(--suggestion-separator));
  
  &:last-child {
    border-bottom: none;
  }
  
  &:hover {
    background-color: hsl(var(--suggestion-hover-bg));
  }
  
  &.search-suggestion--selected {
    background-color: hsl(var(--suggestion-selected-bg));
  }
  
  // Icône de la suggestion
  &__icon {
    margin-right: var(--spacing-sm);
    color: hsl(var(--suggestion-icon));
    flex-shrink: 0;
    
    svg {
      width: var(--font-size-sm);
      height: var(--font-size-sm);
    }
  }
  
  // Texte de la suggestion
  &__text {
    color: hsl(var(--suggestion-text));
    font-size: var(--font-size-sm);
    line-height: var(--line-height-normal);
    flex: 1;
  }
}

// ===== RESPONSIVE =====

// Tablette
@include breakpoints.breakpoint-down(medium)  {
  .search-container {
    max-width: 17.5rem; // 280px
  }
  
  .search-input {
    font-size: var(--font-size-base); // Éviter le zoom sur iOS
    
    &::placeholder {
      font-size: var(--font-size-sm);
    }
  }
}

// Mobile
@include breakpoints.breakpoint-down(small)  {
  .search-container {
    max-width: 12.5rem; // 200px
  }
  
  .search-form {
    height: var(--spacing-3xl); // ~32px
  }
  
  .search-input {
    padding: 0 var(--spacing-3xl) 0 var(--spacing-3xl);
    font-size: var(--font-size-sm);
    
    &::placeholder {
      font-size: var(--font-size-xs);
    }
  }
  
  .search-icon {
    left: var(--spacing-sm);
    
    svg {
      width: var(--font-size-sm);
      height: var(--font-size-sm);
    }
  }
  
  .search-clear {
    right: calc(var(--spacing-sm) + var(--spacing-2px));
    width: calc(var(--spacing-lg) + var(--spacing-2px));
    height: calc(var(--spacing-lg) + var(--spacing-2px));
    
    svg {
      width: var(--font-size-xs);
      height: var(--font-size-xs);
    }
  }
}

